# ComfyUI-MechaBaby-NodeLayout

[English](README.md) | **中文**

节点布局辅助扩展，在 ComfyUI 界面画布上帮助排列和对齐节点。**不直接修改工作流文件**，仅在前端界面上提供辅助操作。

## 功能

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| **F8**（默认） | 打开排列方式选择菜单 |
| **F9**（默认） | 打开展开/收缩节点菜单 |

均可在各自子菜单中通过「⚙ 排列菜单快捷键」「⚙ 展开菜单快捷键」自定义为其他按键。

### 排列方式

| 模式 | 说明 |
|------|------|
| **按类型分组** | 相同类型节点放一起，组内右对齐 |
| **按执行顺序** | 按拓扑排序从左到右排列 |
| **蜘蛛网排列** | 脑图风格：以选中节点为中心递归向左右展开，每个分支独立垂直排列 |
| **层级列排列** | 以选中节点为中心按层级分列，左侧输入链、右侧输出链，同列不重叠 |
| **网格排列** | 规整网格排列 |
| **内置排列 (左)** | 调用 ComfyUI 自带的 arrange 方法 |

**蜘蛛网**和**层级列**以选中节点为中心；未选中时以最后一个输出节点（如 SaveImage）或画布最后一个节点为中心。

无输出节点（如 SaveImage、PreviewImage）会被排在**上级节点右侧**，而不会放在左侧。

### 展开/收缩

| 操作 | 说明 |
|------|------|
| **收缩选中节点** | 仅显示标题栏 |
| **展开选中节点** | 显示完整内容 |
| **收缩全部** / **展开全部** | 作用于画布所有节点 |
| **节点右键** | 右键节点可选择「▶ 收缩节点」或「◀ 展开节点」 |

### 尺寸缩小

- **缩小到最小高度**：保持宽度，高度按 inputs/outputs/widgets 计算
- **缩小到最小宽度**：保持高度，宽度按内容计算
- **缩小到最小尺寸**：宽高均缩小到能完全显示属性的最小值

### 对齐工具

作用于选中节点（未选中时作用于全部）：

- **对齐**：左/右/顶/底
- **居中**：水平/垂直
- **等尺寸**：等宽/等高
- **分布**：水平/垂直均匀分布

## 使用方法

1. **快捷键**：按 **F8**（或自定义键）直接打开排列菜单
2. **右键菜单**：画布空白处**右键** → **▣ MechaBaby 节点布局** → 选择排列或对齐方式

选中节点时，对齐与分布只作用于选中节点；排列模式作用于选中节点（若有）或全部节点。

## 安装

将本扩展放入 `ComfyUI/custom_nodes/` 目录，重启 ComfyUI。

```bash
cd ComfyUI/custom_nodes
git clone https://github.com/MechaBabyAi/ComfyUI-MechaBaby-NodeLayout.git
```

## 兼容性

适用于标准 ComfyUI（LiteGraph），可与 ComfyUI-Custom-Scripts、KayTool 等扩展共存。

---

[English](README.md)
